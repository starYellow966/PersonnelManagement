<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>客运段人事管理系统</title>
    <link rel="stylesheet" href="../static/css/bootstrap.min.css" /> 
    <link rel="stylesheet" href="../static/css/bootstrap-table.css">
    <link rel="stylesheet" href="../static/css/bootstrap-select.css">
    <link rel="stylesheet" href="../static/css/bootstrap-datetimepicker.min.css" media="screen">
    <link rel="stylesheet" href="../static/css/style.css" /> 
    <link rel="stylesheet" href="../static/css/sidebar-menu.css">
    <link rel="stylesheet" href="http://cdn.bootcss.com/font-awesome/4.6.0/css/font-awesome.min.css">

</style>
  <!--[if IE]>
    <script src="http://libs.useso.com/js/html5shiv/3.7/html5shiv.min.js"></script>
<![endif]-->
</head>
<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation"> 
        <div class="container-fluid"> 
            <div class="navbar-header"> 
                <a class="navbar-brand" href="/">客运段人事管理系统</a> 
            </div> 
            <ul class="nav navbar-nav navbar-right"> 
                <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> 登录</a></li> 
            </ul> 
        </div> 
    </nav>
    <aside class="main-sidebar">
        <section  class="sidebar">
            <ul class="sidebar-menu">
                <li class="treeview">
                    <a href="#">
                        <i class="fa fa-dashboard"></i> <span>人员管理</span> <i class="fa fa-angle-left pull-right"></i>
                    </a>
                    <ul class="treeview-menu">
                        <li><a href="#"><i class="fa fa-circle-o"></i> 人员信息管理</a></li>
                        <li><a href="#"><i class="fa fa-circle-o"></i> 人员信息浏览</a></li>
                        <!-- <li><a href="#"><i class="fa fa-circle-o"></i> 人员信息浏览</a></li> -->
                        <!-- <li><a href="#"><i class="fa fa-circle-o"></i> 人员列表查询</a></li> -->
                        <li><a href="#"><i class="fa fa-circle-o"></i> 人员信息统计</a></li>
                        <li><a href="#"><i class="fa fa-circle-o"></i> 人员变动管理</a></li>
                    </ul>
                </li>
                <li class="treeview">
                    <a href="#">
                        <i class="fa fa-laptop"></i>
                        <span>数据标准管理</span>
                        <i class="fa fa-angle-left pull-right"></i>
                    </a>
                    <ul class="treeview-menu">
                        <li><a href="#"><i class="fa fa-circle-o"></i> 数据字典管理</a></li>
                        <li><a href="/org"><i class="fa fa-circle-o"></i> 组织机构管理</a></li>
                    </ul>
                </li>
                <li class="treeview">
                    <a href="#">
                        <i class="fa fa-pie-chart"></i>
                        <span>统计分析</span>
                        <i class="fa fa-angle-left pull-right"></i>
                    </a>
                    <ul class="treeview-menu">
                        <li><a href="#"><i class="fa fa-circle-o"></i> 人员变动统计</a></li>
                    </ul>
                </li>
                <li class="treeview">
                    <a href="#">
                        <i class="fa fa-edit"></i> <span>系统管理</span>
                        <i class="fa fa-angle-left pull-right"></i>
                    </a>
                    <ul class="treeview-menu">
                        <li><a href="#"><i class="fa fa-circle-o"></i> 系统日志管理</a></li>
                        <li><a href="#"><i class="fa fa-circle-o"></i> 登录用户管理</a></li>
                    </ul>
                </li>
            </ul>
        </section>
    </aside>
    
    <div class="container">
        <table id="table"></table>
    </div>

    <!-- 详情模态框 -->
    <div class="modal fade" id="detailModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                    aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="detailModal_title"></h4>
                </div> <!-- modal.header -->
                <form class="modal-body" id="detailModal_form">
                    <label>编号:</label>
                    <input type="text" name="detailModal_id" id="detailModal_id" class="form-control" readonly="true">
                    <span id="detailModal_id_tip" style="color: red"></span>
                    <br>
                    <label>操作者:</label>
                    <input type="text" name="detailModal_name" id="detailModal_name" class="form-control" readonly="true">
                    <label>ip地址:</label>
                    <input type="text" name="detailModal_ip" id="detailModal_name" class="form-control" readonly="true">
                    <label>操作类型:</label>
                    <input type="text" name="detailModal_type" id="detailModal_name" class="form-control" readonly="true">
                    <label>操作时间:</label>
                    <input type="text" name="detailModal_time" id="detailModal_name" class="form-control" readonly="true">
                    <label>操作详情:</label>
                    <input type="text" name="detailModal_detail" id="detailModal_name" class="form-control" readonly="true">
                </form>
            </div><!-- modal-content end -->
        </div><!-- modal-dialog end -->
        
    </div><!-- 详情模态框end -->

    <script src="../static/js/jquery-2.1.1.min.js"></script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script src="../static/js/bootstrap-table.js"></script>
    <script src="../static/js/bootstrap-select.js"></script>
    <script src="../static/js/jquery.form.js"></script>
    <script src="../static/js/sidebar-menu.js"></script>
    <script src="../static/js/bootstrap-table-export.js"></script>
    <script src="../static/js/tableExport.js"></script><!-- bootstrap table本身是没有实现表格的导出的，需要扩展插件tableExport，扩展的tableExport在导出csv，txt，sql，json等格式的时候能很好的支持中文 -->
    
    <!-- 初始化函数 -->
    <script >
        $(document).ready(function(){

            //table初始化
            $('#table').bootstrapTable({
                url:'/log/listall?id=' + {{ current_user.id }},
                toolbar:'#table_toolbar',
                search: true, //是否显示 搜索框
                showColumns: true, //是否显示 选择显示列按钮
                pagination: true, //设置分页
                pageList: [25,50,100],
                pageSize: 25,
                idField: 'id', //重要,可设置checkbox的值为指定字段
                selectItemName: 'id', //设置checkbox name属性，可用于遍历获取选中值
                clickToSelect: true, //将在点击行时，自动选择checkbox
                striped: true, //是否显示 表格条纹
                showExport: true, //是否显示导出按钮
                exportDataType: 'all',//FIXME:导出文件方式  支持: 'basic', 'all', 'selected'. basic：本页数据，all，获取服务器所有数据，selected,本页选择行数据
                Icon: 'glyphicon-export', //导出的图标设置
                exportOptions:{ //导出文件格式设置
                    ignoreColumns:[6],
                    fileName: '操作日志表'
                },
                columns: [{
                    field: 'id',
                    title: '编号',
                    sortable: true
                }, {
                    field: 'user_name',
                    title: '操作者',
                    sortable: true
                }, {
                    field: 'ip_address',
                    title: 'ip地址',
                    sortable: true
                }, {
                    field: 'event_type',
                    title: '操作类型',
                    sortable: true
                }, {
                    field: 'date_time',
                    title: '操作时间',
                    sortable: true,
                    formatter: function(value,row,index){
                        //实现时间戳转时间（%Y-%M-%d）
                        //value 是时间戳
                        //js中时间戳转时间时时间戳要乘以1000
                        var date = new Date(value*1000);//将时间戳转成时间Date
                        //格式化显示
                        return date.getFullYear() + "-" + (date.getMonth()+1) + "-" + date.getDate() + " " + date.getHours() + ";" + date.getMinutes() + ":" + date.getSeconds();
                    }
                }, {
                    field: 'info',
                    title: '操作详情',
                    sortable: true
                }, {
                    field: 'operate',
                    title: '详情',
                    formatter: function(value, row, index){
                        return "<a href='#' data-toggle='modal' onclick='initModalFunc(\""+row+"\")'>详情</a>" ;
                    }
                }],
            });
            
            //菜单初始化
            $.sidebarMenu($('.sidebar-menu'));

        });
    </script>
    
    <!-- 功能函数 -->
    <script>

        
        /**
         * 初始化修改段信息模态框
         * 第1步，初始化标题和提交按钮的响应事件
         * 第2步，提交按钮设置
         * 第3步，显示模态框 
         * @return 显示修改段信息模态框
         */
         function initModalFunc(row){
            $('#detailModal_id').val(row.id);
            $('#detailModal_name').val(row.user_name);
            $('#detailModal_ip').val(row.ip_address);
            $('#detailModal_type').val(row.event_type);
            $('#detailModal_time').val(row.date_time);
            $('#detailModal_detail').val(row.info);
            $('#detailModal').modal('show');
        }

        
    </script>

    <!-- 发送请求函数 -->
    <script>

    </script>
</body>
</html>