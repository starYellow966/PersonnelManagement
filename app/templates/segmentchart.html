<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>客运段表</title>
  <link rel="stylesheet" type="text/css" href="../static/css/bootstrap.min.css" /> 
  <link rel="stylesheet" href="../static/css/bootstrap-table.css">
  <link rel="stylesheet" type="text/css" href="../static/css/style.css" /> 
  <link rel="stylesheet" href="../static/css/sidebar-menu.css">
  <link rel="stylesheet" type="text/css" href="http://cdn.bootcss.com/font-awesome/4.6.0/css/font-awesome.min.css">
</head> 
<body>
    <!-- 测导航 -->
    <aside class="main-sidebar">
        <section  class="sidebar">
            <ul class="sidebar-menu">
              <li class="header" style="color: white;font-size: 180%"><strong>人事管理系统</strong></li>
              <li class="treeview">
                <a href="#">
                  <i class="fa fa-dashboard"></i> <span>人员管理</span> <i class="fa fa-angle-left pull-right"></i>
                </a>
                <ul class="treeview-menu">
                  <li><a href="#"><i class="fa fa-circle-o"></i> 人员信息管理</a></li>
                  <li><a href="#"><i class="fa fa-circle-o"></i> 人员信息浏览</a></li>
                  <li><a href="#"><i class="fa fa-circle-o"></i> 人员信息浏览</a></li>
                  <li><a href="#"><i class="fa fa-circle-o"></i> 人员列表查询</a></li>
                  <li><a href="#"><i class="fa fa-circle-o"></i> 人员信息统计</a></li>
                  <li><a href="#"><i class="fa fa-circle-o"></i> 人员变动管理</a></li>
                </ul>
              </li>
              <li class="treeview">
                <a href="#">
                  <i class="fa fa-laptop"></i>
                  <span>数据标准管理</span>
                  <i class="fa fa-angle-left pull-right"></i>
                </a>
                <ul class="treeview-menu">
                  <li><a href="#"><i class="fa fa-circle-o"></i> 数据字典管理</a></li>
                  <li><a href="#"><i class="fa fa-circle-o"></i> 组织机构管理</a></li>
                </ul>
              </li>
              <li class="treeview">
                <a href="#">
                  <i class="fa fa-pie-chart"></i>
                  <span>统计分析</span>
                  <i class="fa fa-angle-left pull-right"></i>
                </a>
                <ul class="treeview-menu">
                  <li><a href="#"><i class="fa fa-circle-o"></i> 人员变动统计</a></li>
                </ul>
              </li>
              <li class="treeview">
                <a href="#">
                  <i class="fa fa-edit"></i> <span>系统管理</span>
                  <i class="fa fa-angle-left pull-right"></i>
                </a>
                <ul class="treeview-menu">
                  <li><a href="#"><i class="fa fa-circle-o"></i> 系统日志管理</a></li>
                  <li><a href="#"><i class="fa fa-circle-o"></i> 登录用户管理</a></li>
                </ul>
              </li>
            </ul>
        </section>
     </aside>
    
    <!-- 表格 -->
    <div class="container" >
        <!-- <div class="col-sm-2">
            <ul class="sidebar-menu" style="position: fixed;height: 100%">
              <li class="header" style="color: white;font-size: 180%"><strong>组织机构管理</strong></li>
              <li><a href="/org/segment"><i class="fa fa-circle-o"></i>段信息管理</a></li>
              <li><a href="/org/workshop"><i class="fa fa-circle-o"></i>车间信息管理</a></li>
              <li><a href="/org/team"><i class="fa fa-circle-o"></i>班组信息管理</a></li>                 
            </ul>
        </div> -->
        <div >
            <!-- toolbar工具栏 -->
            <div id="toolbar" class="btn-group">
                <button id="btn_add" type="button" class="btn btn-default" onclick="insertModalfunc()">
                    <span class="glyphicon glyphicon-plus" aria-hidden="true" ></span>新增
                </button>
                <button id="btn_remove" type="button" class="btn btn-default" onclick="delSegfunc()">
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
                </button>
            </div><!-- toolbar工具栏.end -->

            <table id="table"></table> 
        </div>
                
    </div>

    <!-- 模态框（Modal） -->
    <div class="modal fade" id="detailModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="modalTitle" name="modalTitle"></h4>
                </div> <!-- modal.header -->
                <div class="modal-body">
                    <ul>
                        <li>
                            <label>编号：</label>
                            <input type="text" id="id" name="id" />
                        </li>
                        <li>
                            <label>名称：</label>
                            <input type="text" id="name" name="name" />
                        </li>
                        <li>
                            <label>类型：</label>
                            <input type="text" id="type" name="type" />
                        </li>
                        <li>
                            <label>部门名称：</label>
                            <input type="text" id="dep_name" name="dep_name" />
                        </li>
                        <li>
                            <label>成立时间：</label>
                            <input type="text" name="seg_date" id="seg_date" />
                        </li>
                        <li>
                            <label>所属路局：</label>
                            <input type="text" name="railway" id="railway" />
                        </li>
                    </ul>
                </div><!-- modal-body -->
                <div class="modal-footer">
                    <button class="btn btn-default" data-dismiss="modal">取消</button>
                    <button id="submit_btn" class="btn btn-primary" >提交更改</button>
                </div> <!-- modal-footer -->
            </div><!-- /.modal.content -->
        </div><!-- /.modal -->
    </div><!-- 模态框（Modal）end -->

    <script src="../static/js/jquery-2.1.1.min.js"></script>
    <script src="../static/js/bootstrap.min.js"></script>
    <script src="../static/js/bootstrap-table.js"></script>
    <script src="../static/js/sidebar-menu.js"></script>
    
    <script type="text/javascript">
        $("#table").bootstrapTable({
            url: '/org/seg/listAll',
            toolbar: '#toolbar',
            search: true, //是否显示 搜索框
            // showRefresh: true,//是否显示 刷新按钮
            showColumns: true, //是否显示 选择显示列按钮
            pagination: true,  //设置分页
            idField: "id",   //重要---可设置checkbox的值为指定字段
            clickToSelect:true,//设置true 将在点击行时，自动选择checkbox
            striped:true,//是否显示 表格条纹
            //height: 1000,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
            pageList:[5,10,15,20],
            pageSize:5,
            selectItemName:"id",    //设置checkbox name属性，可用于遍历获取选中值
            exportDataType:'all',
            showExport: true,  //是否显示导出按钮
            exportTypes:['excel'],  //导出文件类型  
            //buttonsAlign:"left",  //按钮位置 
            Icons:'glyphicon-export',  
            exportOptions:{  
                   fileName: 'CategoryList',  //设置导出文件名称  
                   worksheetName: 'sheet1',  //表格工作区名称  
                   tableName: 'CategoryList',
                   excelstyles: ['background-color', 'color', 'font-size', 'font-weight']
            }, 
            columns:[{
                checkbox: true,
            }, {
                field : 'id',
                title : '编号',
                sortable: true
            }, {
                field: 'name',
                title: '名称',
                sortable: true
            }, {
                field: 'stype',
                title: '类型',
                sortable: true
            }, {
                field: 'dep_name',
                title: '部门名称',
                sortable: true
            }, {
                field: 'seg_date',
                title: '成立时间',
                sortable: true,
                formatter: function(value,row,index){
                    //实现时间戳转时间（%Y-%M-%d）
                    //value 是时间戳
                    //js中时间戳转时间时时间戳要乘以1000
                    var date = new Date(value*1000);//将时间戳转成时间Date
                    //格式化显示
                    return date.getFullYear() + "-" + (date.getMonth()+1) + "-" + date.getDate();
                }
            }, {
                field: 'railway',
                title: '所属铁路局',
                sortable: true
            },{
                field: 'operation',
                title: '操作',
                align: 'center',
                valign: 'middle',
                formatter: function(value,row,index){
                    return "<a href='#' data-toggle='modal' onclick='editModalfunc(\""+row.id+"\",\""+row.name+"\",\""+row.stype+"\",\""+row.dep_name+"\",\""+row.seg_date+"\",\""+row.railway+"\")' >修改</a> <a href='#' onclick='deleteSegmentRequest(\""+row.id+"\")' >删除</a>"
                }
            }],
        });
    </script>
    <script>
        $.sidebarMenu($('.sidebar-menu')) //侧导航
    </script>
    <script type="text/javascript">
        /**
         * 显示插入段信息的模态框
         *
         * 第一步，设置插入段信息模态框中组件的属性，以及通过参数设置组件的值
         * 第二步，显示插入段信息的模态框
         */
        function insertModalfunc(){
            $("#id").val("").attr("readonly",false);
            $("#name").val("");
            $("#type").val("客运段");
            $("#dep_name").val("");
            $("#seg_date").val("");
            $("#railway").val("");
            $("#modalTitle").text("新增段信息");
            $("#submit_btn").click(insertSegRequest); //将提交更改按钮绑定插入操作
            $("#detailModal").modal("show");
        }

        /**
         * 显示更新段信息的模态框
         *
         * 第一步，设置更新段信息模态框中组件的属性，以及通过参数设置组件的值
         * 第二步，显示更新段信息的模态框
         */
        function editModalfunc(id,name,type,dep_name,seg_date,railway){
            $("#id").val(id).attr("readonly",true);
            $("#name").val(name);
            $("#type").val(type);
            $("#dep_name").val(dep_name);
            var date = new Date(seg_date*1000);//seg_date是时间戳 需要转换
            $("#seg_date").val(date.getFullYear() + "-" + (date.getMonth()+1) + "-" + date.getDate());
            $("#railway").val(railway);
            $("#modalTitle").text("修改段信息");
            $("#submit_btn").click(updateSegRequest); //将提交更改按钮绑定修改操作
            $("#detailModal").modal("show");
        }
        /**
         * 发送更新段信息请求
         * 
         * 第一步，获取模态框中的值
         * 第二步，判断模态框值的合法性（TODO）
         * 第三步，用post方式，当请求成功后重新加载页面
         */
        var updateSegRequest = function updateSegmentRequest(){
            var id = $("#id").val();
            var name = $("#name").val();
            var type = $("#type").val();
            var dep_name = $("#dep_name").val();
            var seg_date = $("#seg_date").val();
            var railway = $("#railway").val();
            //TODO 缺少内容审核
            $.post("/org/seg/update",{
                id: id,
                name: name,
                type: type,
                dep_name: dep_name,
                seg_date: seg_date,
                railway: railway
            },function(data,status){
                //FIXME 用只刷新表格代替
                window.location.reload();
            });
        }

        /**
         * 发送插入段信息请求
         * 
         * 第一步，获取模态框中的值
         * 第二步，判断模态框值的合法性（TODO）
         * 第三步，用post方式，当请求成功后重新加载页面
         */
        var insertSegRequest = function insertSegmentRequest(){
            var id = $("#id").val();
            var name = $("#name").val();
            var type = $("#type").val();
            var dep_name = $("#dep_name").val();
            var seg_date = $("#seg_date").val();
            var railway = $("#railway").val();
            //TODO 缺少内容审核
            $.post("/org/seg/insert",{
                id: id,
                name: name,
                type: type,
                dep_name: dep_name,
                seg_date: seg_date,
                railway: railway
            },function(data){
                //FIXME 用只刷新表格代替
                window.location.reload();
            });
        }

        /**
         * 多项删除响应函数
         *
         * 第一步，通过getSelections获得选中的项，返回值是数组
         * 第二步，将数组转换成字符串（如1,2,3或1）
         * 第三步，调用发送删除段信息请求函数deleteSegmentRequest(target)
         */
        function delSegfunc(){
            var array = $("#table").bootstrapTable('getSelections');//返回所选的行，当没有选择任何行的时候返回一个空数组。
            var target = "";
            //将数组转换成字符串
            for (var i = array.length - 1; i >= 0; i--) {
                target +=array[i].id;
                if(i > 0 )
                    target +=",";
            }
            deleteSegmentRequest(target);
        }

        /**
         * 发送删除段信息请求
         * 
         * 第一步，用post方式，当请求成功后重新加载页面
         * @param  {待删除的id字符串（格式：1,2,3或者1）}
         * @return {从表格删除行}
         */
        function deleteSegmentRequest(target){
            $.post("/org/seg/delete",{ids:target},function(data,status){//当成功时调用这个函数，移除删除项
                alert("delete ：" + status);
                $("#table").bootstrapTable('remove', {field: 'id', values: target.split(',')});
                
            });
        }

        // /**
        //  * 加载数据到表格中，旧数据会被替换。
        //  * 直接发请求，然后把响应返回的data直接加载到表格
        //  * @return 无
        //  */
        // var reloadTable = function(){
        //     $.post('/org/getallSegment',function(data){//当成功时调用这个函数,data是返回值,
        //         alert(data);
        //         $('#table').bootstrapTable('load',data);
        //     });
        // }
    </script>
    

</body>
</html>