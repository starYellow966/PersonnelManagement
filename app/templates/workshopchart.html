<!DOCTYPE html>
<html>

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<title>车间管理表</title>
	<link rel="stylesheet" type="text/css" href="../static/css/bootstrap.min.css" /> 
	<link rel="stylesheet" href="../static/css/bootstrap-table.css">
	<link rel="stylesheet" href="../static/css/bootstrap-select.css">
	<link rel="stylesheet" type="text/css" href="../static/css/style.css" /> 
	<link rel="stylesheet" href="../static/css/sidebar-menu.css">
	<link rel="stylesheet" type="text/css" href="http://cdn.bootcss.com/font-awesome/4.6.0/css/font-awesome.min.css">
</head> 
<body>
		<!-- 测导航 -->
		<aside class="main-sidebar">
				<section  class="sidebar">
						<ul class="sidebar-menu">
							<li class="header" style="color: white;font-size: 180%"><strong>人事管理系统</strong></li>
							<li class="treeview">
								<a href="#">
									<i class="fa fa-dashboard"></i> <span>人员管理</span> <i class="fa fa-angle-left pull-right"></i>
								</a>
								<ul class="treeview-menu">
									<li><a href="#"><i class="fa fa-circle-o"></i> 人员信息管理</a></li>
									<li><a href="#"><i class="fa fa-circle-o"></i> 人员信息浏览</a></li>
									<li><a href="#"><i class="fa fa-circle-o"></i> 人员信息浏览</a></li>
									<li><a href="#"><i class="fa fa-circle-o"></i> 人员列表查询</a></li>
									<li><a href="#"><i class="fa fa-circle-o"></i> 人员信息统计</a></li>
									<li><a href="#"><i class="fa fa-circle-o"></i> 人员变动管理</a></li>
								</ul>
							</li>
							<li class="treeview">
								<a href="#">
									<i class="fa fa-laptop"></i>
									<span>数据标准管理</span>
									<i class="fa fa-angle-left pull-right"></i>
								</a>
								<ul class="treeview-menu">
									<li><a href="#"><i class="fa fa-circle-o"></i> 数据字典管理</a></li>
									<li><a href="#"><i class="fa fa-circle-o"></i> 组织机构管理</a></li>
								</ul>
							</li>
							<li class="treeview">
								<a href="#">
									<i class="fa fa-pie-chart"></i>
									<span>统计分析</span>
									<i class="fa fa-angle-left pull-right"></i>
								</a>
								<ul class="treeview-menu">
									<li><a href="#"><i class="fa fa-circle-o"></i> 人员变动统计</a></li>
								</ul>
							</li>
							<li class="treeview">
								<a href="#">
									<i class="fa fa-edit"></i> <span>系统管理</span>
									<i class="fa fa-angle-left pull-right"></i>
								</a>
								<ul class="treeview-menu">
									<li><a href="#"><i class="fa fa-circle-o"></i> 系统日志管理</a></li>
									<li><a href="#"><i class="fa fa-circle-o"></i> 登录用户管理</a></li>
								</ul>
							</li>
						</ul>
				</section>
		 </aside>
		
		<!-- 表格 -->
		<div class="container" >
				<!-- <div class="col-sm-2">
						<ul class="sidebar-menu" style="position: fixed;height: 100%">
							<li class="header" style="color: white;font-size: 180%"><strong>组织机构管理</strong></li>
							<li><a href="/org/segment"><i class="fa fa-circle-o"></i>段信息管理</a></li>
							<li><a href="/org/workshop"><i class="fa fa-circle-o"></i>车间信息管理</a></li>
							<li><a href="/org/team"><i class="fa fa-circle-o"></i>班组信息管理</a></li>                 
						</ul>
				</div> -->
				<div >
						<!-- toolbar工具栏 -->
						<div id="toolbar" class="btn-group">
								<button id="btn_add" type="button" class="btn btn-default" onclick="insertModalfunc()">
										<span class="glyphicon glyphicon-plus" aria-hidden="true" ></span>新增
								</button>
								<button id="btn_remove" type="button" class="btn btn-default" onclick="delWorkshopfunc()">
										<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
								</button>
						</div><!-- toolbar工具栏.end -->

						<table id="table"></table> 
				</div>
								
		</div>

		<!-- 模态框（Modal） -->
		<div class="modal fade" id="detailModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog">
						<form method="post">
								<div class="modal-content">
										<div class="modal-header">
												<button type="button" class="close" data-dismiss="modal"
																aria-hidden="true">&times;</button>
												<h4 class="modal-title" id="modalTitle" name="modalTitle"></h4>
										</div> <!-- modal.header -->
										<div class="modal-body">
												<ul>
														<li>
																<label>编号：</label>
																<input type="text" id="id" name="id" maxlength="10" required="required" />
														</li>
														<li>
																<label>名称：</label>
																<input type="text" id="name" name="name" required="required" />
														</li>
														<li>
																<label>类型：</label>
																<input type="text" id="type" name="type" required="required" />
														</li>
														<li>
																<label>部门名称：</label>
																<input type="text" id="dep_name" name="dep_name" required="required" />
														</li>
														<li>
																<label>所属客运段：</label>
																<select id="seg_name" class="selectpicker" data-live-search="true"></select>
														</li>
														<li>
																<label>序号：</label>
																<input type="number" name="num" id="num" required="required" />
														</li>
												</ul>
										</div><!-- modal-body -->
										<div class="modal-footer">
												<button class="btn btn-default" data-dismiss="modal">取消</button>
												<input type="submit" id="submit_btn" class="btn btn-primary" value="提交更改"></input>
										</div> <!-- modal-footer -->
								</div><!-- /.modal.content -->
						</form>
				</div><!-- /.modal -->
		</div><!-- 模态框（Modal）end -->

		<script src="../static/js/jquery-2.1.1.min.js"></script>
		<script src="../static/js/bootstrap.min.js"></script>
		<script src="../static/js/bootstrap-table.js"></script>
		<script src="../static/js/bootstrap-select.js"></script>
		<script src="../static/js/sidebar-menu.js"></script>
		
		<script type="text/javascript">
				$("#table").bootstrapTable({
						url: '/org/work/listAll',
						toolbar: '#toolbar',
						search: true, //是否显示 搜索框
						// showRefresh: true,//是否显示 刷新按钮
						showColumns: true, //是否显示 选择显示列按钮
						pagination: true,  //设置分页
						idField: "id",   //重要---可设置checkbox的值为指定字段
						clickToSelect:true,//设置true 将在点击行时，自动选择checkbox
						striped:true,//是否显示 表格条纹
						//height: 1000,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
						pageList:[5,10,15,20],
						pageSize:5,
						selectItemName:"id",    //设置checkbox name属性，可用于遍历获取选中值
						exportDataType:'all',
						showExport: true,  //是否显示导出按钮
						exportTypes:['excel'],  //导出文件类型  
						//buttonsAlign:"left",  //按钮位置 
						Icons:'glyphicon-export',  
						exportOptions:{  
									 fileName: 'CategoryList',  //设置导出文件名称  
									 worksheetName: 'sheet1',  //表格工作区名称  
									 tableName: 'CategoryList',
									 excelstyles: ['background-color', 'color', 'font-size', 'font-weight']
						}, 
						columns:[{
								checkbox: true,
						}, {
								field : 'id',
								title : '编号',
								sortable: true
						}, {
								field: 'name',
								title: '名称',
								sortable: true
						}, {
								field: 'wtype',
								title: '类型',
								sortable: true
						}, {
								field: 'dep_name',
								title: '部门名称',
								sortable: true
						}, {
								field: 'seg_name',
								title: '所属客运段',
								sortable: true,
						}, {
								field: 'num',
								title: '序号',
								sortable: true
						},{
								field: 'operation',
								title: '操作',
								align: 'center',
								valign: 'middle',
								formatter: function(value,row,index){
										return "<a href='#' data-toggle='modal' onclick='editModalfunc(\""+row.id+"\",\""+row.name+"\",\""+row.wtype+"\",\""+row.dep_name+"\",\""+row.seg_name+"\",\""+row.num+"\")' >修改</a> <a href='#' onclick='deleteWorkshopRequest(\""+row.id+"\")' >删除</a>"
								}
						}],
				});
		</script>
		<script>
				$.sidebarMenu($('.sidebar-menu')) //侧导航
		</script>
		<script type="text/javascript">
				/**
				 * 显示插入段信息的模态框
				 *
				 * 第一步，设置插入段信息模态框中组件的属性，以及通过参数设置组件的值
				 * 第二步，显示插入段信息的模态框
				 */
				function insertModalfunc(){
						initSelectpicker();
						$("#id").val("").attr("readonly",false);
						$("#name").val("");
						$("#type").val("车间");
						$("#dep_name").val("");
						$("#num").val("");
						$("#modalTitle").text("新增段信息");
						$("#submit_btn").click(insertWorkRequest); //将提交更改按钮绑定插入操作
						$("#detailModal").modal("show");
				}

				/**
				 * 显示更新段信息的模态框
				 *
				 * 第一步，设置更新段信息模态框中组件的属性，以及通过参数设置组件的值
				 * 第二步，显示更新段信息的模态框
				 */
				function editModalfunc(id,name,type,dep_name,seg_name,num){
						initSelectpicker();
						$("#id").val(id).attr("readonly",true);
						$("#name").val(name);
						$("#type").val(type);
						$("#dep_name").val(dep_name);
						$("#seg_name").selectpicker('val',seg_name);
						$("#num").val(num);
						$("#modalTitle").text("修改段信息");
						$("#submit_btn").click(updateWorkRequest); //将提交更改按钮绑定修改操作
						$("#detailModal").modal("show");
				}
				/**
				 * 发送更新段信息请求
				 * 
				 * 第一步，获取模态框中的值
				 * 第二步，判断模态框值的合法性（TODO）
				 * 第三步，用post方式，当请求成功后重新加载页面
				 */
				var updateWorkRequest = function updateWorkshopRequest(){
						var id = $("#id").val();
						var name = $("#name").val();
						var type = $("#type").val();
						var dep_name = $("#dep_name").val();
						var seg_id = $("#seg_name").val(); 
						var num = $("#num").val();
						//TODO 缺少内容审核
						$.post("/org/work/update",{
								id: id,
								name: name,
								type: type,
								dep_name: dep_name,
								seg_id: seg_id,
								num: num
						},function(data,status){
								//FIXME 用只刷新表格代替
								window.location.reload();
						});
				}

				/**
				 * 发送插入段信息请求
				 * 
				 * 第一步，获取模态框中的值
				 * 第二步，判断模态框值的合法性（TODO）
				 * 第三步，用post方式，当请求成功后重新加载页面
				 */
				var insertWorkRequest = function insertWorkshopRequest(){
						var id = $("#id").val();
						var name = $("#name").val();
						var type = $("#type").val();
						var dep_name = $("#dep_name").val();
						var seg_id = $("#seg_name").val();
						var num = $("#num").val();
						//TODO 缺少内容审核
						$.post("/org/work/insert",{
								id: id,
								name: name,
								type: type,
								dep_name: dep_name,
								seg_id: seg_id,
								num: num
						},function(data){
								//FIXME 用只刷新表格代替
								window.location.reload();
						});
				}

				/**
				 * 多项删除响应函数
				 *
				 * 第一步，通过getSelections获得选中的项，返回值是数组
				 * 第二步，将数组转换成字符串（如1,2,3或1）
				 * 第三步，调用发送删除段信息请求函数deleteWorkshopRequest(target)
				 */
				function delWorkshopfunc(){
						var array = $("#table").bootstrapTable('getSelections');//返回所选的行，当没有选择任何行的时候返回一个空数组。
						var target = "";
						//将数组转换成字符串
						for (var i = array.length - 1; i >= 0; i--) {
								target +=array[i].id;
								if(i > 0 )
										target +=",";
						}
						deleteWorkshopRequest(target);
				}

				/**
				 * 发送删除段信息请求
				 * 
				 * 第一步，用post方式，当请求成功后重新加载页面
				 * @param  {待删除的id字符串（格式：1,2,3或者1）}
				 * @return {从表格删除行}
				 */
				function deleteWorkshopRequest(target){
						$.post("/org/work/delete",{ids:target},function(data,status){//当成功时调用这个函数，移除删除项
								alert("delete ：" + status);
								$("#table").bootstrapTable('remove', {field: 'id', values: target.split(',')});
								
						});
				}

				/**
				 * 初始化模态框中的下拉框的选项
				 *
				 * 第一步，发送获取Segment中所有数据请求,地址'/seg/listAll'
				 * 第二步，设置下拉框的选项 value=seg_id,显示值=seg_name
				 */
				function initSelectpicker(){
						$.post("/org/seg/listAll", 
							function(data,status){
									$('#seg_name').html("");
									var text ="";
									// 转换为json对象
									var dataObj=eval("("+data+")");
									for(var i in dataObj){
											text += '<option value="' + dataObj[i].id + '">' + dataObj[i].name + '</option>';
									}
									$("#seg_name").html(text);
									$("#seg_name").selectpicker('refresh');
							});
				}

		</script>
		

</body>
</html>